{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "vdoc Manifest",
  "description": "Schema for vdocs/_manifest.json - tracks documentation state",
  "type": "object",
  "required": ["project", "language", "last_updated", "vdoc_version", "documentation", "source_index"],
  "properties": {
    "project": {
      "type": "string",
      "description": "Project name (from package.json, pyproject.toml, or directory name)"
    },
    "language": {
      "type": "string",
      "description": "Primary language (typescript, javascript, python, go, rust, java, default)"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp of last update"
    },
    "vdoc_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "vdoc version that generated this manifest"
    },
    "documentation": {
      "type": "array",
      "description": "Array of documentation page entries",
      "items": {
        "$ref": "#/definitions/DocumentationEntry"
      }
    },
    "source_index": {
      "type": "object",
      "description": "Map of source file paths to metadata",
      "additionalProperties": {
        "$ref": "#/definitions/SourceEntry"
      }
    }
  },
  "definitions": {
    "DocumentationEntry": {
      "type": "object",
      "required": ["path", "title", "covers", "audience", "description"],
      "properties": {
        "path": {
          "type": "string",
          "description": "Relative path to documentation file (e.g., vdocs/overview.md)"
        },
        "title": {
          "type": "string",
          "description": "Human-readable title for the documentation page"
        },
        "covers": {
          "oneOf": [
            {
              "type": "array",
              "items": { "type": "string" },
              "description": "Array of source file paths or glob patterns"
            },
            {
              "type": "string",
              "enum": ["auto", "none"],
              "description": "auto = AI finds related files, none = user fills manually"
            }
          ],
          "description": "Source files this documentation covers"
        },
        "audience": {
          "type": "string",
          "description": "Target audience (e.g., 'all team members', 'backend engineers')"
        },
        "description": {
          "type": "string",
          "description": "Brief summary of what this documentation page contains"
        }
      }
    },
    "SourceEntry": {
      "type": "object",
      "required": ["hash", "category", "description", "description_source", "documented_in"],
      "properties": {
        "hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{10}$",
          "description": "Truncated SHA-256 hash at time of last documentation"
        },
        "category": {
          "type": "string",
          "description": "Functional category from DOC_SIGNALS matching"
        },
        "description": {
          "type": "string",
          "description": "Brief description of what this file does"
        },
        "description_source": {
          "type": "string",
          "enum": ["docstring", "inferred", "analyzed"],
          "description": "How the description was derived"
        },
        "documented_in": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Array of documentation page paths that reference this file"
        }
      }
    }
  }
}
